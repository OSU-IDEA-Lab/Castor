<?xml version="1.0" encoding="UTF-8"?>
<project name="ProGolem-In-DB-Server" default="serverStart">
	<description>
	Ant Script for VoltDB activities.
	</description>
	
	<property name="ddlFileName" value=""/>
	<property name="ddlLocation" location="./ddl"/>
	<property name="jarFileName" value="catalog.jar"/>
	<!--<property name="VoltHome" value="/Users/jose/voltdb"/>-->
	<!--<property name="VoltLicense" value="${env.VOLTDB_HOME}/voltdb/license.xml"/>-->
	<property name="sourceCodePath" value="../ProGolem-In-DB-StoredProcedures/src"/>
	<property name="compileOutputDir" value="../ProGolem-In-DB-StoredProcedures/bin"/>
	<property name="voltClasspath" value=".:${env.VOLTDB_HOME}/lib/*:${env.VOLTDB_HOME}/voltdb/*"/>
	
	<property environment="env"/>
	
	<path id="class.path">
		<fileset dir="${env.VOLTDB_HOME}">
		<include name="**/*.jar"/>
		<include name="./bin"/>
		</fileset>
	</path>
	
	
	<!-- ================================= 
	target: serverStart
	Start the server after compiling the DDL and stored procedures 
	================================= -->
	<target name="serverStart" depends="catalog">
		<exec executable="${env.VOLTDB_HOME}/bin/voltdb">
		<arg value="create"/>
		<arg value="--deployment"/>
		<arg value="deployment.xml"/>
		<arg value="${jarFileName}"/>
		<env key="VOLTDB_HEAPMAX" value="25000"/>
		<!--<arg value="host localhost"/>-->
		<!--<arg value="deployment deployment.xml"/>-->
		<!--<arg value="license ${VoltLicense}"/>-->
		</exec>
	</target>
	<!-- =================================
	target: catalog
	Runs voltdb compile command to create the VoltDB catalog jar file 
	================================= -->
	<target name="catalog">
		<exec executable="${env.VOLTDB_HOME}/bin/voltdb">
		<arg value="compile"/>
		<arg value="-o"/>
		<arg value="${jarFileName}"/>
		<arg value="${ddlLocation}/${ddlFileName}"/>
		</exec>
	</target>
	<!-- =================================
	target: serverStop
	Runs voltadmin shutdown on the default port.
	================================= -->
	<target name="serverStop">
		<exec executable="${env.VOLTDB_HOME}/bin/voltadmin">
		<arg value="shutdown"/>
		</exec>
	</target>
	<!-- =================================
	target: clean
	Deletes the class files from compile.src
	================================= -->
	<target name="clean">
		<delete includeEmptyDirs="true">
			<fileset dir="${compileOutputDir}" includes="**/*" defaultexcludes="no"/>
			<fileset dir="log" includes="**/*" defaultexcludes="no"/>
			<fileset dir="voltdbroot" includes="**/*" defaultexcludes="no"/>
		</delete>
		<delete dir="log"/>
		<delete dir="voltdbroot"/>
		<delete file="${jarFileName}"/>
		<delete file="catalog-report.html"/>
	</target>
</project>